'use strict';

exports.__esModule = true;

var _modal = require('antd/lib/modal');

var _modal2 = _interopRequireDefault(_modal);

var _button = require('antd/lib/button');

var _button2 = _interopRequireDefault(_button);

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _tabs = require('antd/lib/tabs');

var _tabs2 = _interopRequireDefault(_tabs);

var _dec, _class, _class2, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _Edit = require('./Edit.js');

var _Edit2 = _interopRequireDefault(_Edit);

var _View = require('./View.js');

var _View2 = _interopRequireDefault(_View);

var _reactRouter = require('react-router');

var _interface = require('../../../../reducer/modules/interface.js');

var _reactRouterDom = require('react-router-dom');

var _Run = require('./Run/Run.js');

var _Run2 = _interopRequireDefault(_Run);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var plugin = require('../../../../plugin.js');

var TabPane = _tabs2.default.TabPane;
var Content = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    curdata: state.inter.curdata,
    list: state.inter.list,
    editStatus: state.inter.editStatus
  };
}, {
  fetchInterfaceData: _interface.fetchInterfaceData
}), _dec(_class = (_temp = _class2 = function (_Component) {
  (0, _inherits3.default)(Content, _Component);

  function Content(props) {
    (0, _classCallCheck3.default)(this, Content);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.switchToView = function () {
      _this.setState({
        curtab: 'view'
      });
    };

    _this.onChange = function (key) {
      if (_this.state.curtab === 'edit' && _this.props.editStatus) {
        _this.showModal();
      } else {
        _this.setState({
          curtab: key
        });
      }
      _this.setState({
        nextTab: key
      });
    };

    _this.handleOk = function () {
      _this.setState({
        visible: false,
        curtab: _this.state.nextTab
      });
    };

    _this.showModal = function () {
      _this.setState({
        visible: true
      });
    };

    _this.handleCancel = function () {
      _this.setState({
        visible: false
      });
    };

    _this.title = 'YApi-高效、易用、功能强大的可视化接口管理平台';
    _this.state = {
      curtab: 'view',
      visible: false,
      nextTab: ''
    };
    return _this;
  }

  Content.prototype.componentWillMount = function componentWillMount() {
    var params = this.props.match.params;
    this.actionId = params.actionId;
    this.handleRequest(this.props);
  };

  Content.prototype.componentWillUnmount = function componentWillUnmount() {
    document.getElementsByTagName('title')[0].innerText = this.title;
  };

  Content.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
    var params = nextProps.match.params;
    if (params.actionId !== this.actionId) {
      this.actionId = params.actionId;
      this.handleRequest(nextProps);
    }
  };

  Content.prototype.handleRequest = function handleRequest(nextProps) {
    var params = nextProps.match.params;
    this.props.fetchInterfaceData(params.actionId);
    this.setState({
      curtab: 'view'
    });
  };
  // 确定离开页面

  // 离开编辑页面的提示

  // 取消离开编辑页面


  Content.prototype.render = function render() {
    if (this.props.curdata.title) {
      document.getElementsByTagName('title')[0].innerText = this.props.curdata.title + '-' + this.title;
    }

    var InterfaceTabs = {
      view: {
        component: _View2.default,
        name: '预览'
      },
      edit: {
        component: _Edit2.default,
        name: '编辑'
      },
      run: {
        component: _Run2.default,
        name: '运行'
      }
    };

    plugin.emitHook('interface_tab', InterfaceTabs);

    var tabs = _react2.default.createElement(
      _tabs2.default,
      {
        className: 'tabs-large',
        onChange: this.onChange,
        activeKey: this.state.curtab,
        defaultActiveKey: 'view'
      },
      (0, _keys2.default)(InterfaceTabs).map(function (key) {
        var item = InterfaceTabs[key];
        return _react2.default.createElement(TabPane, { tab: item.name, key: key });
      })
    );
    var tabContent = null;
    if (this.state.curtab) {
      var C = InterfaceTabs[this.state.curtab].component;
      tabContent = _react2.default.createElement(C, { switchToView: this.switchToView });
    }

    return _react2.default.createElement(
      'div',
      { className: 'interface-content' },
      _react2.default.createElement(_reactRouter.Prompt, {
        when: this.state.curtab === 'edit' && this.props.editStatus ? true : false,
        message: function message() {
          // this.showModal();
          return '离开页面会丢失当前编辑的内容，确定要离开吗？';
        }
      }),
      tabs,
      tabContent,
      this.state.visible && _react2.default.createElement(
        _modal2.default,
        {
          title: '\u4F60\u5373\u5C06\u79BB\u5F00\u7F16\u8F91\u9875\u9762',
          visible: this.state.visible,
          onCancel: this.handleCancel,
          footer: [_react2.default.createElement(
            _button2.default,
            { key: 'back', onClick: this.handleCancel },
            '\u53D6 \u6D88'
          ), _react2.default.createElement(
            _button2.default,
            { key: 'submit', onClick: this.handleOk },
            '\u786E \u5B9A'
          )]
        },
        _react2.default.createElement(
          'p',
          null,
          '\u79BB\u5F00\u9875\u9762\u4F1A\u4E22\u5931\u5F53\u524D\u7F16\u8F91\u7684\u5185\u5BB9\uFF0C\u786E\u5B9A\u8981\u79BB\u5F00\u5417\uFF1F'
        )
      )
    );
  };

  return Content;
}(_react.PureComponent), _class2.propTypes = {
  match: _propTypes2.default.object,
  list: _propTypes2.default.array,
  curdata: _propTypes2.default.object,
  fetchInterfaceData: _propTypes2.default.func,
  history: _propTypes2.default.object,
  editStatus: _propTypes2.default.bool
}, _temp)) || _class);
exports.default = (0, _reactRouterDom.withRouter)(Content);