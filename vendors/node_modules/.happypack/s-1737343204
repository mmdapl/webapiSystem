'use strict';

exports.__esModule = true;
exports.default = undefined;

var _spin = require('antd/lib/spin');

var _spin2 = _interopRequireDefault(_spin);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _tabs = require('antd/lib/tabs');

var _tabs2 = _interopRequireDefault(_tabs);

var _layout = require('antd/lib/layout');

var _layout2 = _interopRequireDefault(_layout);

var _dec, _class, _class2, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _GroupList = require('./GroupList/GroupList.js');

var _GroupList2 = _interopRequireDefault(_GroupList);

var _ProjectList = require('./ProjectList/ProjectList.js');

var _ProjectList2 = _interopRequireDefault(_ProjectList);

var _MemberList = require('./MemberList/MemberList.js');

var _MemberList2 = _interopRequireDefault(_MemberList);

var _GroupLog = require('./GroupLog/GroupLog.js');

var _GroupLog2 = _interopRequireDefault(_GroupLog);

var _GroupSetting = require('./GroupSetting/GroupSetting.js');

var _GroupSetting2 = _interopRequireDefault(_GroupSetting);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _reactRedux = require('react-redux');

var _reactRouterDom = require('react-router-dom');

var _news = require('../../reducer/modules/news.js');

var _group = require('../../reducer/modules/group');

require('./Group.scss');

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Content = _layout2.default.Content,
    Sider = _layout2.default.Sider;

var TabPane = _tabs2.default.TabPane;
var Group = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    curGroupId: state.group.currGroup._id,
    curUserRole: state.user.role,
    curUserRoleInGroup: state.group.currGroup.role || state.group.role,
    currGroup: state.group.currGroup
  };
}, {
  fetchNewsData: _news.fetchNewsData,
  setCurrGroup: _group.setCurrGroup
}), _dec(_class = (_temp = _class2 = function (_Component) {
  (0, _inherits3.default)(Group, _Component);

  function Group(props) {
    (0, _classCallCheck3.default)(this, Group);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.state = {
      groupId: -1
    };
    return _this;
  }

  Group.prototype.componentDidMount = function () {
    var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      var r, group;
      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return _axios2.default.get('/api/group/get_mygroup');

            case 2:
              r = _context.sent;

              try {
                group = r.data.data;

                this.setState({
                  groupId: group._id
                });
                this.props.setCurrGroup(group);
              } catch (e) {
                console.error(e);
              }

            case 4:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, this);
    }));

    function componentDidMount() {
      return _ref.apply(this, arguments);
    }

    return componentDidMount;
  }();

  // onTabClick=(key)=> {
  //   // if (key == 3) {
  //   //   this.props.fetchNewsData(this.props.curGroupId, "group", 1, 10)
  //   // }
  // }
  Group.prototype.render = function render() {
    if (this.state.groupId === -1) return _react2.default.createElement(_spin2.default, null);
    var GroupContent = _react2.default.createElement(
      _layout2.default,
      { style: { minHeight: 'calc(100vh - 100px)', marginLeft: '24px', marginTop: '24px' } },
      _react2.default.createElement(
        Sider,
        { style: { height: '100%' }, width: 300 },
        _react2.default.createElement('div', { className: 'logo' }),
        _react2.default.createElement(_GroupList2.default, null)
      ),
      _react2.default.createElement(
        _layout2.default,
        null,
        _react2.default.createElement(
          Content,
          {
            style: {
              height: '100%',
              margin: '0 24px 0 16px',
              overflow: 'initial',
              backgroundColor: '#fff'
            }
          },
          _react2.default.createElement(
            _tabs2.default,
            { type: 'card', className: 'm-tab tabs-large', style: { height: '100%' } },
            _react2.default.createElement(
              TabPane,
              { tab: '\u9879\u76EE\u5217\u8868', key: '1' },
              _react2.default.createElement(_ProjectList2.default, null)
            ),
            this.props.currGroup.type === 'public' ? _react2.default.createElement(
              TabPane,
              { tab: '\u6210\u5458\u5217\u8868', key: '2' },
              _react2.default.createElement(_MemberList2.default, null)
            ) : null,
            ['admin', 'owner', 'guest', 'dev'].indexOf(this.props.curUserRoleInGroup) > -1 || this.props.curUserRole === 'admin' ? _react2.default.createElement(
              TabPane,
              { tab: '\u5206\u7EC4\u52A8\u6001', key: '3' },
              _react2.default.createElement(_GroupLog2.default, null)
            ) : '',
            (this.props.curUserRole === 'admin' || this.props.curUserRoleInGroup === 'owner') && this.props.currGroup.type !== 'private' ? _react2.default.createElement(
              TabPane,
              { tab: '\u5206\u7EC4\u8BBE\u7F6E', key: '4' },
              _react2.default.createElement(_GroupSetting2.default, null)
            ) : null
          )
        )
      )
    );
    return _react2.default.createElement(
      'div',
      { className: 'projectGround' },
      _react2.default.createElement(
        _reactRouterDom.Switch,
        null,
        _react2.default.createElement(_reactRouterDom.Redirect, { exact: true, from: '/group', to: "/group/" + this.state.groupId }),
        _react2.default.createElement(_reactRouterDom.Route, { path: '/group/:groupId', render: function render() {
            return GroupContent;
          } })
      )
    );
  };

  return Group;
}(_react.PureComponent), _class2.propTypes = {
  fetchNewsData: _propTypes2.default.func,
  curGroupId: _propTypes2.default.number,
  curUserRole: _propTypes2.default.string,
  currGroup: _propTypes2.default.object,
  curUserRoleInGroup: _propTypes2.default.string,
  setCurrGroup: _propTypes2.default.func
}, _temp)) || _class);
exports.default = Group;