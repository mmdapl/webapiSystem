'use strict';

exports.__esModule = true;
exports.default = undefined;

var _button = require('antd/lib/button');

var _button2 = _interopRequireDefault(_button);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _switch = require('antd/lib/switch');

var _switch2 = _interopRequireDefault(_switch);

var _tooltip = require('antd/lib/tooltip');

var _tooltip2 = _interopRequireDefault(_tooltip);

var _icon = require('antd/lib/icon');

var _icon2 = _interopRequireDefault(_icon);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _message2 = require('antd/lib/message');

var _message3 = _interopRequireDefault(_message2);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _form = require('antd/lib/form');

var _form2 = _interopRequireDefault(_form);

var _dec, _dec2, _class, _class2, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _AceEditor = require('../../../../components/AceEditor/AceEditor');

var _AceEditor2 = _interopRequireDefault(_AceEditor);

var _project = require('../../../../reducer/modules/project');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var FormItem = _form2.default.Item;


var formItemLayout = {
  labelCol: {
    sm: { span: 4 }
  },
  wrapperCol: {
    sm: { span: 16 }
  }
};
var tailFormItemLayout = {
  wrapperCol: {
    sm: {
      span: 16,
      offset: 11
    }
  }
};

var ProjectMock = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    projectMsg: state.project.currProject
  };
}, {
  updateProjectMock: _project.updateProjectMock,
  getProject: _project.getProject
}), _dec2 = _form2.default.create(), _dec(_class = _dec2(_class = (_temp = _class2 = function (_Component) {
  (0, _inherits3.default)(ProjectMock, _Component);

  function ProjectMock(props) {
    var _this2 = this;

    (0, _classCallCheck3.default)(this, ProjectMock);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.handleSubmit = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      var params, result;
      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              params = {
                id: _this.props.projectId,
                project_mock_script: _this.state.project_mock_script,
                is_mock_open: _this.state.is_mock_open
              };
              _context.next = 3;
              return _this.props.updateProjectMock(params);

            case 3:
              result = _context.sent;

              if (!(result.payload.data.errcode === 0)) {
                _context.next = 10;
                break;
              }

              _message3.default.success('保存成功');
              _context.next = 8;
              return _this.props.getProject(_this.props.projectId);

            case 8:
              _context.next = 11;
              break;

            case 10:
              _message3.default.success('保存失败, ' + result.payload.data.errmsg);

            case 11:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, _this2);
    }));

    _this.onChange = function (v) {
      _this.setState({
        is_mock_open: v
      });
    };

    _this.handleMockJsInput = function (e) {
      _this.setState({
        project_mock_script: e.text
      });
    };

    _this.state = {
      is_mock_open: false,
      project_mock_script: ''
    };
    return _this;
  }

  ProjectMock.prototype.componentWillMount = function componentWillMount() {
    this.setState({
      is_mock_open: this.props.projectMsg.is_mock_open,
      project_mock_script: this.props.projectMsg.project_mock_script
    });
  };

  // 是否开启


  ProjectMock.prototype.render = function render() {
    return _react2.default.createElement(
      'div',
      { className: 'm-panel' },
      _react2.default.createElement(
        _form2.default,
        null,
        _react2.default.createElement(
          FormItem,
          (0, _extends3.default)({
            label: _react2.default.createElement(
              'span',
              null,
              '\u662F\u5426\u5F00\u542F\xA0',
              _react2.default.createElement(
                'a',
                {
                  target: '_blank',
                  rel: 'noopener noreferrer',
                  href: 'https://hellosean1025.github.io/yapi/documents/project.html#%E5%85%A8%E5%B1%80mock'
                },
                _react2.default.createElement(
                  _tooltip2.default,
                  { title: '\u70B9\u51FB\u67E5\u770B\u6587\u6863' },
                  _react2.default.createElement(_icon2.default, { type: 'question-circle-o' })
                )
              )
            )
          }, formItemLayout),
          _react2.default.createElement(_switch2.default, {
            checked: this.state.is_mock_open,
            onChange: this.onChange,
            checkedChildren: '\u5F00',
            unCheckedChildren: '\u5173'
          })
        ),
        _react2.default.createElement(
          FormItem,
          (0, _extends3.default)({ label: 'Mock\u811A\u672C' }, formItemLayout),
          _react2.default.createElement(_AceEditor2.default, {
            data: this.state.project_mock_script,
            onChange: this.handleMockJsInput,
            style: { minHeight: '500px' }
          })
        ),
        _react2.default.createElement(
          FormItem,
          tailFormItemLayout,
          _react2.default.createElement(
            _button2.default,
            { type: 'primary', htmlType: 'submit', onClick: this.handleSubmit },
            '\u4FDD\u5B58'
          )
        )
      )
    );
  };

  return ProjectMock;
}(_react.Component), _class2.propTypes = {
  form: _propTypes2.default.object,
  match: _propTypes2.default.object,
  projectId: _propTypes2.default.number,
  updateProjectMock: _propTypes2.default.func,
  projectMsg: _propTypes2.default.object,
  getProject: _propTypes2.default.func
}, _temp)) || _class) || _class);
exports.default = ProjectMock;