'use strict';

exports.__esModule = true;

var _spin = require('antd/lib/spin');

var _spin2 = _interopRequireDefault(_spin);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _temp; /**
                    * Created by gxl.gao on 2017/10/25.
                    */

// import PropTypes from 'prop-types'


var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

var _recharts = require('recharts');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var StatisChart = (_temp = _class = function (_Component) {
  (0, _inherits3.default)(StatisChart, _Component);

  function StatisChart(props) {
    (0, _classCallCheck3.default)(this, StatisChart);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.state = {
      showLoading: true,
      chartDate: {
        mockCount: 0,
        mockDateList: []
      }
    };
    return _this;
  }

  StatisChart.prototype.componentWillMount = function componentWillMount() {
    this.getMockData();
  };

  // 获取mock 请求次数信息


  StatisChart.prototype.getMockData = function () {
    var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      var result, mockStatisData;
      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return _axios2.default.get('/api/plugin/statismock/get');

            case 2:
              result = _context.sent;

              if (result.data.errcode === 0) {
                mockStatisData = result.data.data;

                this.setState({
                  showLoading: false,
                  chartDate: (0, _extends3.default)({}, mockStatisData)
                });
              }

            case 4:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, this);
    }));

    function getMockData() {
      return _ref.apply(this, arguments);
    }

    return getMockData;
  }();

  StatisChart.prototype.render = function render() {
    var width = 1050;
    var _state$chartDate = this.state.chartDate,
        mockCount = _state$chartDate.mockCount,
        mockDateList = _state$chartDate.mockDateList;


    return _react2.default.createElement(
      'div',
      null,
      _react2.default.createElement(
        _spin2.default,
        { spinning: this.state.showLoading },
        _react2.default.createElement(
          'div',
          { className: 'statis-chart-content' },
          _react2.default.createElement(
            'h3',
            { className: 'statis-title' },
            'mock \u63A5\u53E3\u8BBF\u95EE\u603B\u6570\u4E3A\uFF1A',
            mockCount.toLocaleString()
          ),
          _react2.default.createElement(
            'div',
            { className: 'statis-chart' },
            _react2.default.createElement(
              _recharts.LineChart,
              {
                width: width,
                height: 300,
                data: mockDateList,
                margin: { top: 5, right: 30, left: 20, bottom: 5 }
              },
              _react2.default.createElement(_recharts.XAxis, { dataKey: '_id' }),
              _react2.default.createElement(_recharts.YAxis, null),
              _react2.default.createElement(_recharts.CartesianGrid, { strokeDasharray: '7 3' }),
              _react2.default.createElement(_recharts.Tooltip, null),
              _react2.default.createElement(_recharts.Legend, null),
              _react2.default.createElement(_recharts.Line, {
                name: 'mock\u7EDF\u8BA1\u503C',
                type: 'monotone',
                dataKey: 'count',
                stroke: '#8884d8',
                activeDot: { r: 8 }
              })
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'statis-footer' },
            '\u8FC7\u53BB3\u4E2A\u6708mock\u63A5\u53E3\u8C03\u7528\u60C5\u51B5'
          )
        )
      )
    );
  };

  return StatisChart;
}(_react.Component), _class.propTypes = {}, _temp);
exports.default = StatisChart;