'use strict';

exports.__esModule = true;

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _tabs = require('antd/lib/tabs');

var _tabs2 = _interopRequireDefault(_tabs);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _layout = require('antd/lib/layout');

var _layout2 = _interopRequireDefault(_layout);

var _dec, _class, _class2, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _reactRouterDom = require('react-router-dom');

var _reactRedux = require('react-redux');

require('./interface.scss');

var _InterfaceMenu = require('./InterfaceList/InterfaceMenu.js');

var _InterfaceMenu2 = _interopRequireDefault(_InterfaceMenu);

var _InterfaceList = require('./InterfaceList/InterfaceList.js');

var _InterfaceList2 = _interopRequireDefault(_InterfaceList);

var _InterfaceContent = require('./InterfaceList/InterfaceContent.js');

var _InterfaceContent2 = _interopRequireDefault(_InterfaceContent);

var _InterfaceColMenu = require('./InterfaceCol/InterfaceColMenu.js');

var _InterfaceColMenu2 = _interopRequireDefault(_InterfaceColMenu);

var _InterfaceColContent = require('./InterfaceCol/InterfaceColContent.js');

var _InterfaceColContent2 = _interopRequireDefault(_InterfaceColContent);

var _InterfaceCaseContent = require('./InterfaceCol/InterfaceCaseContent.js');

var _InterfaceCaseContent2 = _interopRequireDefault(_InterfaceCaseContent);

var _project = require('../../../reducer/modules/project');

var _interfaceCol = require('../../../reducer/modules/interfaceCol.js');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Content = _layout2.default.Content,
    Sider = _layout2.default.Sider;

var contentRouter = {
  path: '/project/:id/interface/:action/:actionId',
  exact: true
};

var InterfaceRoute = function InterfaceRoute(props) {
  var C = void 0;
  if (props.match.params.action === 'api') {
    if (!props.match.params.actionId) {
      C = _InterfaceList2.default;
    } else if (!isNaN(props.match.params.actionId)) {
      C = _InterfaceContent2.default;
    } else if (props.match.params.actionId.indexOf('cat_') === 0) {
      C = _InterfaceList2.default;
    }
  } else if (props.match.params.action === 'col') {
    C = _InterfaceColContent2.default;
  } else if (props.match.params.action === 'case') {
    C = _InterfaceCaseContent2.default;
  } else {
    var params = props.match.params;
    props.history.replace('/project/' + params.id + '/interface/api');
    return null;
  }
  return _react2.default.createElement(C, props);
};

InterfaceRoute.propTypes = {
  match: _propTypes2.default.object,
  history: _propTypes2.default.object
};

var Interface = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    isShowCol: state.interfaceCol.isShowCol
  };
}, {
  setColData: _interfaceCol.setColData,
  getProject: _project.getProject
}), _dec(_class = (_temp = _class2 = function (_Component) {
  (0, _inherits3.default)(Interface, _Component);

  function Interface(props) {
    (0, _classCallCheck3.default)(this, Interface);

    // this.state = {
    //   curkey: this.props.match.params.action === 'api' ? 'api' : 'colOrCase'
    // }
    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.onChange = function (action) {
      var params = _this.props.match.params;
      if (action === 'colOrCase') {
        action = _this.props.isShowCol ? 'col' : 'case';
      }
      _this.props.history.push('/project/' + params.id + '/interface/' + action);
    };

    return _this;
  }

  Interface.prototype.componentWillMount = function () {
    var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              this.props.setColData({
                isShowCol: true
              });
              // await this.props.fetchInterfaceColList(this.props.match.params.id)

            case 1:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, this);
    }));

    function componentWillMount() {
      return _ref.apply(this, arguments);
    }

    return componentWillMount;
  }();

  Interface.prototype.render = function render() {
    var action = this.props.match.params.action;
    // const activeKey = this.state.curkey;

    var activeKey = action === 'api' ? 'api' : 'colOrCase';

    return _react2.default.createElement(
      _layout2.default,
      { style: { minHeight: 'calc(100vh - 156px)', marginLeft: '24px', marginTop: '24px' } },
      _react2.default.createElement(
        Sider,
        { style: { height: '100%' }, width: 300 },
        _react2.default.createElement(
          'div',
          { className: 'left-menu' },
          _react2.default.createElement(
            _tabs2.default,
            { type: 'card', className: 'tabs-large', activeKey: activeKey, onChange: this.onChange },
            _react2.default.createElement(_tabs2.default.TabPane, { tab: '\u63A5\u53E3\u5217\u8868', key: 'api' }),
            _react2.default.createElement(_tabs2.default.TabPane, { tab: '\u6D4B\u8BD5\u96C6\u5408', key: 'colOrCase' })
          ),
          activeKey === 'api' ? _react2.default.createElement(_InterfaceMenu2.default, {
            router: (0, _reactRouterDom.matchPath)(this.props.location.pathname, contentRouter),
            projectId: this.props.match.params.id
          }) : _react2.default.createElement(_InterfaceColMenu2.default, {
            router: (0, _reactRouterDom.matchPath)(this.props.location.pathname, contentRouter),
            projectId: this.props.match.params.id
          })
        )
      ),
      _react2.default.createElement(
        _layout2.default,
        null,
        _react2.default.createElement(
          Content,
          {
            style: {
              height: '100%',
              margin: '0 24px 0 16px',
              overflow: 'initial',
              backgroundColor: '#fff'
            }
          },
          _react2.default.createElement(
            'div',
            { className: 'right-content' },
            _react2.default.createElement(
              _reactRouterDom.Switch,
              null,
              _react2.default.createElement(_reactRouterDom.Route, { exact: true, path: '/project/:id/interface/:action', component: InterfaceRoute }),
              _react2.default.createElement(_reactRouterDom.Route, (0, _extends3.default)({}, contentRouter, { component: InterfaceRoute }))
            )
          )
        )
      )
    );
  };

  return Interface;
}(_react.PureComponent), _class2.propTypes = {
  match: _propTypes2.default.object,
  history: _propTypes2.default.object,
  location: _propTypes2.default.object,
  isShowCol: _propTypes2.default.bool,
  getProject: _propTypes2.default.func,
  setColData: _propTypes2.default.func
  // fetchInterfaceColList: PropTypes.func
}, _temp)) || _class);
exports.default = Interface;