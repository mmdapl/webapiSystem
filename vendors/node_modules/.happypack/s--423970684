'use strict';

exports.__esModule = true;
exports.default = undefined;

var _modal = require('antd/lib/modal');

var _modal2 = _interopRequireDefault(_modal);

var _button = require('antd/lib/button');

var _button2 = _interopRequireDefault(_button);

var _icon = require('antd/lib/icon');

var _icon2 = _interopRequireDefault(_icon);

var _row = require('antd/lib/row');

var _row2 = _interopRequireDefault(_row);

var _col = require('antd/lib/col');

var _col2 = _interopRequireDefault(_col);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _message2 = require('antd/lib/message');

var _message3 = _interopRequireDefault(_message2);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _collapse = require('antd/lib/collapse');

var _collapse2 = _interopRequireDefault(_collapse);

var _input = require('antd/lib/input');

var _input2 = _interopRequireDefault(_input);

var _dec, _class, _class2, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

var _reactRouter = require('react-router');

var _interfaceCol = require('../../../../../reducer/modules/interfaceCol');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var TextArea = _input2.default.TextArea;

var Panel = _collapse2.default.Panel;

var AddColModal = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    interfaceColList: state.interfaceCol.interfaceColList
  };
}, {
  fetchInterfaceColList: _interfaceCol.fetchInterfaceColList
}), _dec(_class = (0, _reactRouter.withRouter)(_class = (_temp = _class2 = function (_Component) {
  (0, _inherits3.default)(AddColModal, _Component);

  function AddColModal(props) {
    var _this2 = this;

    (0, _classCallCheck3.default)(this, AddColModal);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.state = {
      visible: false,
      addColName: '',
      addColDesc: '',
      id: 0,
      caseName: ''
    };
    _this.addCol = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      var _this$state, name, desc, project_id, res;

      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _this$state = _this.state, name = _this$state.addColName, desc = _this$state.addColDesc;
              project_id = _this.props.match.params.id;
              _context.next = 4;
              return _axios2.default.post('/api/col/add_col', { name: name, desc: desc, project_id: project_id });

            case 4:
              res = _context.sent;

              if (res.data.errcode) {
                _context.next = 12;
                break;
              }

              _message3.default.success('添加集合成功');
              _context.next = 9;
              return _this.props.fetchInterfaceColList(project_id);

            case 9:

              _this.setState({ id: res.data.data._id });
              _context.next = 13;
              break;

            case 12:
              _message3.default.error(res.data.errmsg);

            case 13:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, _this2);
    }));

    _this.select = function (id) {
      _this.setState({ id: id });
    };

    return _this;
  }

  AddColModal.prototype.componentWillMount = function componentWillMount() {
    this.props.fetchInterfaceColList(this.props.match.params.id);
    this.setState({ caseName: this.props.caseName });
  };

  AddColModal.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
    this.setState({ id: nextProps.interfaceColList[0]._id });
    this.setState({ caseName: nextProps.caseName });
  };

  AddColModal.prototype.render = function render() {
    var _this3 = this;

    var _props$interfaceColLi = this.props.interfaceColList,
        interfaceColList = _props$interfaceColLi === undefined ? [] : _props$interfaceColLi;
    var id = this.state.id;

    return _react2.default.createElement(
      _modal2.default,
      {
        className: 'add-col-modal',
        title: '\u6DFB\u52A0\u5230\u96C6\u5408',
        visible: this.props.visible,
        onOk: function onOk() {
          return _this3.props.onOk(id, _this3.state.caseName);
        },
        onCancel: this.props.onCancel
      },
      _react2.default.createElement(
        _row2.default,
        { gutter: 6, className: 'modal-input' },
        _react2.default.createElement(
          _col2.default,
          { span: '5' },
          _react2.default.createElement(
            'div',
            { className: 'label' },
            '\u63A5\u53E3\u7528\u4F8B\u540D\uFF1A'
          )
        ),
        _react2.default.createElement(
          _col2.default,
          { span: '15' },
          _react2.default.createElement(_input2.default, {
            placeholder: '\u8BF7\u8F93\u5165\u63A5\u53E3\u7528\u4F8B\u540D\u79F0',
            value: this.state.caseName,
            onChange: function onChange(e) {
              return _this3.setState({ caseName: e.target.value });
            }
          })
        )
      ),
      _react2.default.createElement(
        'p',
        null,
        '\u8BF7\u9009\u62E9\u6DFB\u52A0\u5230\u7684\u96C6\u5408\uFF1A'
      ),
      _react2.default.createElement(
        'ul',
        { className: 'col-list' },
        interfaceColList.length ? interfaceColList.map(function (col) {
          return _react2.default.createElement(
            'li',
            {
              key: col._id,
              className: 'col-item ' + (col._id === id ? 'selected' : ''),
              onClick: function onClick() {
                return _this3.select(col._id);
              }
            },
            _react2.default.createElement(_icon2.default, { type: 'folder-open', style: { marginRight: 6 } }),
            col.name
          );
        }) : _react2.default.createElement(
          'span',
          null,
          '\u6682\u65E0\u96C6\u5408\uFF0C\u8BF7\u6DFB\u52A0\uFF01'
        )
      ),
      _react2.default.createElement(
        _collapse2.default,
        null,
        _react2.default.createElement(
          Panel,
          { header: '\u6DFB\u52A0\u65B0\u96C6\u5408' },
          _react2.default.createElement(
            _row2.default,
            { gutter: 6, className: 'modal-input' },
            _react2.default.createElement(
              _col2.default,
              { span: '5' },
              _react2.default.createElement(
                'div',
                { className: 'label' },
                '\u96C6\u5408\u540D\uFF1A'
              )
            ),
            _react2.default.createElement(
              _col2.default,
              { span: '15' },
              _react2.default.createElement(_input2.default, {
                placeholder: '\u8BF7\u8F93\u5165\u96C6\u5408\u540D\u79F0',
                value: this.state.addColName,
                onChange: function onChange(e) {
                  return _this3.setState({ addColName: e.target.value });
                }
              })
            )
          ),
          _react2.default.createElement(
            _row2.default,
            { gutter: 6, className: 'modal-input' },
            _react2.default.createElement(
              _col2.default,
              { span: '5' },
              _react2.default.createElement(
                'div',
                { className: 'label' },
                '\u7B80\u4ECB\uFF1A'
              )
            ),
            _react2.default.createElement(
              _col2.default,
              { span: '15' },
              _react2.default.createElement(TextArea, {
                rows: 3,
                placeholder: '\u8BF7\u8F93\u5165\u96C6\u5408\u63CF\u8FF0',
                value: this.state.addColDesc,
                onChange: function onChange(e) {
                  return _this3.setState({ addColDesc: e.target.value });
                }
              })
            )
          ),
          _react2.default.createElement(
            _row2.default,
            { type: 'flex', justify: 'end' },
            _react2.default.createElement(
              _button2.default,
              { style: { float: 'right' }, type: 'primary', onClick: this.addCol },
              '\u6DFB \u52A0'
            )
          )
        )
      )
    );
  };

  return AddColModal;
}(_react.PureComponent), _class2.propTypes = {
  visible: _propTypes2.default.bool,
  interfaceColList: _propTypes2.default.array,
  fetchInterfaceColList: _propTypes2.default.func,
  match: _propTypes2.default.object,
  onOk: _propTypes2.default.func,
  onCancel: _propTypes2.default.func,
  caseName: _propTypes2.default.string
}, _temp)) || _class) || _class);
exports.default = AddColModal;