'use strict';

exports.__esModule = true;

var _row = require('antd/lib/row');

var _row2 = _interopRequireDefault(_row);

var _icon = require('antd/lib/icon');

var _icon2 = _interopRequireDefault(_icon);

var _col = require('antd/lib/col');

var _col2 = _interopRequireDefault(_col);

var _input = require('antd/lib/input');

var _input2 = _interopRequireDefault(_input);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

require('./ProjectTag.scss');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ProjectTag = (_temp = _class = function (_Component) {
  (0, _inherits3.default)(ProjectTag, _Component);

  function ProjectTag(props) {
    (0, _classCallCheck3.default)(this, ProjectTag);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.addHeader = function (val, index, name, label) {
      var newValue = {};
      newValue[name] = [].concat(_this.state[name]);
      newValue[name][index][label] = val;
      var nextData = _this.state[name][index + 1];
      if (!(nextData && (typeof nextData === 'undefined' ? 'undefined' : (0, _typeof3.default)(nextData)) === 'object')) {
        var data = { name: '', desc: '' };
        newValue[name] = [].concat(_this.state[name], data);
      }
      _this.setState(newValue);
    };

    _this.delHeader = function (key, name) {
      var curValue = _this.state[name];
      var newValue = {};
      newValue[name] = curValue.filter(function (val, index) {
        return index !== key;
      });
      _this.setState(newValue);
    };

    _this.handleChange = function (val, index, name, label) {
      var newValue = _this.state;
      newValue[name][index][label] = val;
      _this.setState(newValue);
    };

    _this.state = {
      tag: [{ name: '', desc: '' }]
    };
    return _this;
  }

  ProjectTag.prototype.initState = function initState(curdata) {
    var tag = [{
      name: '',
      desc: ''
    }];
    if (curdata && curdata.length !== 0) {
      curdata.forEach(function (item) {
        tag.unshift(item);
      });
    }

    return { tag: tag };
  };

  ProjectTag.prototype.componentDidMount = function componentDidMount() {
    this.handleInit(this.props.tagMsg);
  };

  ProjectTag.prototype.handleInit = function handleInit(data) {
    var newValue = this.initState(data);
    this.setState((0, _extends3.default)({}, newValue));
  };

  ProjectTag.prototype.render = function render() {
    var _this2 = this;

    var commonTpl = function commonTpl(item, index, name) {
      var length = _this2.state[name].length - 1;
      return _react2.default.createElement(
        _row2.default,
        { key: index, className: 'tag-item' },
        _react2.default.createElement(
          _col2.default,
          { span: 6, className: 'item-name' },
          _react2.default.createElement(_input2.default, {
            placeholder: '\u8BF7\u8F93\u5165 ' + name + ' \u540D\u79F0'
            // style={{ width: '200px' }}
            , value: item.name || '',
            onChange: function onChange(e) {
              return _this2.addHeader(e.target.value, index, name, 'name');
            }
          })
        ),
        _react2.default.createElement(
          _col2.default,
          { span: 12 },
          _react2.default.createElement(_input2.default, {
            placeholder: '\u8BF7\u8F93\u5165tag \u63CF\u8FF0\u4FE1\u606F',
            style: { width: '90%', marginRight: 8 },
            onChange: function onChange(e) {
              return _this2.handleChange(e.target.value, index, name, 'desc');
            },
            value: item.desc || ''
          })
        ),
        _react2.default.createElement(
          _col2.default,
          { span: 2, className: index === length ? ' tag-last-row' : null },
          _react2.default.createElement(_icon2.default, {
            className: 'dynamic-delete-button delete',
            type: 'delete',
            onClick: function onClick(e) {
              e.stopPropagation();
              _this2.delHeader(index, name);
            }
          })
        )
      );
    };

    return _react2.default.createElement(
      'div',
      { className: 'project-tag' },
      this.state.tag.map(function (item, index) {
        return commonTpl(item, index, 'tag');
      })
    );
  };

  return ProjectTag;
}(_react.Component), _class.propTypes = {
  tagMsg: _propTypes2.default.array,
  tagSubmit: _propTypes2.default.func
}, _temp);
exports.default = ProjectTag;