'use strict';

exports.__esModule = true;

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _row = require('antd/lib/row');

var _row2 = _interopRequireDefault(_row);

var _col = require('antd/lib/col');

var _col2 = _interopRequireDefault(_col);

var _tooltip = require('antd/lib/tooltip');

var _tooltip2 = _interopRequireDefault(_tooltip);

var _icon = require('antd/lib/icon');

var _icon2 = _interopRequireDefault(_icon);

var _dec, _class, _class2, _temp; /**
                                   * Created by gxl.gao on 2017/10/25.
                                   */

// import { withRouter } from 'react-router-dom';


var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

require('./index.scss');

var _user = require('../../../client/reducer/modules/user');

var _StatisChart = require('./StatisChart');

var _StatisChart2 = _interopRequireDefault(_StatisChart);

var _StatisTable = require('./StatisTable');

var _StatisTable2 = _interopRequireDefault(_StatisTable);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var CountOverview = function CountOverview(props) {
  return _react2.default.createElement(
    _row2.default,
    { type: 'flex', justify: 'space-start', className: 'm-row' },
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        '\u5206\u7EC4\u603B\u6570',
        _react2.default.createElement(
          _tooltip2.default,
          { placement: 'rightTop', title: '\u7EDF\u8BA1yapi\u4E2D\u4E00\u5171\u5F00\u542F\u4E86\u591A\u5C11\u53EF\u89C1\u7684\u516C\u5171\u5206\u7EC4' },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.date.groupCount
      )
    ),
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        '\u9879\u76EE\u603B\u6570',
        _react2.default.createElement(
          _tooltip2.default,
          { placement: 'rightTop', title: '\u7EDF\u8BA1yapi\u4E2D\u5EFA\u7ACB\u7684\u6240\u6709\u9879\u76EE\u603B\u6570' },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.date.projectCount
      )
    ),
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        '\u63A5\u53E3\u603B\u6570',
        _react2.default.createElement(
          _tooltip2.default,
          { placement: 'rightTop', title: '\u7EDF\u8BA1yapi\u6240\u6709\u9879\u76EE\u4E2D\u7684\u6240\u6709\u63A5\u53E3\u603B\u6570' },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.date.interfaceCount
      )
    ),
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        '\u6D4B\u8BD5\u63A5\u53E3\u603B\u6570',
        _react2.default.createElement(
          _tooltip2.default,
          { placement: 'rightTop', title: '\u7EDF\u8BA1yapi\u6240\u6709\u9879\u76EE\u4E2D\u7684\u6240\u6709\u6D4B\u8BD5\u63A5\u53E3\u603B\u6570' },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.date.interfaceCaseCount
      )
    )
  );
};

CountOverview.propTypes = {
  date: _propTypes2.default.object
};

var StatusOverview = function StatusOverview(props) {
  return _react2.default.createElement(
    _row2.default,
    { type: 'flex', justify: 'space-start', className: 'm-row' },
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        '\u64CD\u4F5C\u7CFB\u7EDF\u7C7B\u578B',
        _react2.default.createElement(
          _tooltip2.default,
          {
            placement: 'rightTop',
            title: '\u64CD\u4F5C\u7CFB\u7EDF\u7C7B\u578B,\u8FD4\u56DE\u503C\u6709\'darwin\', \'freebsd\', \'linux\', \'sunos\' , \'win32\''
          },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.data.systemName
      )
    ),
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        'cpu\u8D1F\u8F7D',
        _react2.default.createElement(
          _tooltip2.default,
          { placement: 'rightTop', title: 'cpu\u7684\u603B\u8D1F\u8F7D\u60C5\u51B5' },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.data.load,
        ' %'
      )
    ),
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        '\u7CFB\u7EDF\u7A7A\u95F2\u5185\u5B58\u603B\u91CF / \u5185\u5B58\u603B\u91CF',
        _react2.default.createElement(
          _tooltip2.default,
          { placement: 'rightTop', title: '\u7CFB\u7EDF\u7A7A\u95F2\u5185\u5B58\u603B\u91CF / \u5185\u5B58\u603B\u91CF' },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.data.freemem,
        ' G / ',
        props.data.totalmem,
        ' G',
        ' '
      )
    ),
    _react2.default.createElement(
      _col2.default,
      { className: 'gutter-row', span: 6 },
      _react2.default.createElement(
        'span',
        null,
        '\u90AE\u7BB1\u72B6\u6001',
        _react2.default.createElement(
          _tooltip2.default,
          { placement: 'rightTop', title: '\u68C0\u6D4B\u914D\u7F6E\u6587\u4EF6\u4E2D\u914D\u7F6E\u90AE\u7BB1\u7684\u72B6\u6001' },
          _react2.default.createElement(_icon2.default, { className: 'm-help', type: 'question-circle' })
        )
      ),
      _react2.default.createElement(
        'h2',
        { className: 'gutter-box' },
        props.data.mail
      )
    )
  );
};

StatusOverview.propTypes = {
  data: _propTypes2.default.object
};

var statisticsPage = (_dec = (0, _reactRedux.connect)(null, {
  setBreadcrumb: _user.setBreadcrumb
}), _dec(_class = (_temp = _class2 = function (_Component) {
  (0, _inherits3.default)(statisticsPage, _Component);

  function statisticsPage(props) {
    (0, _classCallCheck3.default)(this, statisticsPage);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.state = {
      count: {
        groupCount: 0,
        projectCount: 0,
        interfaceCount: 0,
        interfactCaseCount: 0
      },
      status: {
        mail: '',
        systemName: '',
        totalmem: '',
        freemem: '',
        uptime: ''
      },
      dataTotal: []
    };
    return _this;
  }

  statisticsPage.prototype.componentWillMount = function () {
    var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              this.props.setBreadcrumb([{ name: '系统信息' }]);
              this.getStatisData();
              this.getSystemStatusData();
              this.getGroupData();

            case 4:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, this);
    }));

    function componentWillMount() {
      return _ref.apply(this, arguments);
    }

    return componentWillMount;
  }();

  // 获取统计数据


  statisticsPage.prototype.getStatisData = function () {
    var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
      var result, statisData;
      return _regenerator2.default.wrap(function _callee2$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return _axios2.default.get('/api/plugin/statismock/count');

            case 2:
              result = _context2.sent;

              if (result.data.errcode === 0) {
                statisData = result.data.data;

                this.setState({
                  count: (0, _extends3.default)({}, statisData)
                });
              }

            case 4:
            case 'end':
              return _context2.stop();
          }
        }
      }, _callee2, this);
    }));

    function getStatisData() {
      return _ref2.apply(this, arguments);
    }

    return getStatisData;
  }();

  // 获取系统信息

  statisticsPage.prototype.getSystemStatusData = function () {
    var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
      var result, statusData;
      return _regenerator2.default.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              _context3.next = 2;
              return _axios2.default.get('/api/plugin/statismock/get_system_status');

            case 2:
              result = _context3.sent;

              if (result.data.errcode === 0) {
                statusData = result.data.data;

                this.setState({
                  status: (0, _extends3.default)({}, statusData)
                });
              }

            case 4:
            case 'end':
              return _context3.stop();
          }
        }
      }, _callee3, this);
    }));

    function getSystemStatusData() {
      return _ref3.apply(this, arguments);
    }

    return getSystemStatusData;
  }();

  // 获取分组详细信息

  statisticsPage.prototype.getGroupData = function () {
    var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4() {
      var result, statusData;
      return _regenerator2.default.wrap(function _callee4$(_context4) {
        while (1) {
          switch (_context4.prev = _context4.next) {
            case 0:
              _context4.next = 2;
              return _axios2.default.get('/api/plugin/statismock/group_data_statis');

            case 2:
              result = _context4.sent;

              if (result.data.errcode === 0) {
                statusData = result.data.data;

                statusData.map(function (item) {
                  return item['key'] = item.name;
                });
                this.setState({
                  dataTotal: statusData
                });
              }

            case 4:
            case 'end':
              return _context4.stop();
          }
        }
      }, _callee4, this);
    }));

    function getGroupData() {
      return _ref4.apply(this, arguments);
    }

    return getGroupData;
  }();

  statisticsPage.prototype.render = function render() {
    var _state = this.state,
        count = _state.count,
        status = _state.status,
        dataTotal = _state.dataTotal;


    return _react2.default.createElement(
      'div',
      { className: 'g-statistic' },
      _react2.default.createElement(
        'div',
        { className: 'content' },
        _react2.default.createElement(
          'h2',
          { className: 'title' },
          '\u7CFB\u7EDF\u72B6\u51B5'
        ),
        _react2.default.createElement(
          'div',
          { className: 'system-content' },
          _react2.default.createElement(StatusOverview, { data: status })
        ),
        _react2.default.createElement(
          'h2',
          { className: 'title' },
          '\u6570\u636E\u7EDF\u8BA1'
        ),
        _react2.default.createElement(
          'div',
          null,
          _react2.default.createElement(CountOverview, { date: count }),
          _react2.default.createElement(_StatisTable2.default, { dataSource: dataTotal }),
          _react2.default.createElement(_StatisChart2.default, null)
        )
      )
    );
  };

  return statisticsPage;
}(_react.Component), _class2.propTypes = {
  setBreadcrumb: _propTypes2.default.func
}, _temp)) || _class);
exports.default = statisticsPage;