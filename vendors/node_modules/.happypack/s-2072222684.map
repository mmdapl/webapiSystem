{"version":3,"sources":["client\\containers\\Project\\Interface\\InterfaceCol\\InterfaceCaseContent.js"],"names":["InterfaceCaseContent","interfaceColList","state","interfaceCol","currColId","currCaseId","currCase","isShowCol","currProject","project","projectEnv","curUid","user","uid","fetchInterfaceColList","fetchCaseData","setColData","fetchCaseList","getEnv","withRouter","props","isEditingCasename","editCasename","savePostmanRef","postman","updateCase","case_env","req_params","req_query","req_headers","req_body_type","req_body_form","req_body_other","test_script","enable_script","test_res_body","test_res_header","casename","id","_id","params","axios","post","res","match","data","errcode","error","errmsg","success","triggerEditCasename","setState","cancelEditCasename","getColId","colList","forEach","col","caseList","caseItem","componentWillMount","result","actionId","payload","history","push","project_id","componentWillReceiveProps","nextProps","oldCaseId","newCaseId","render","env","pre_script","after_script","padding","e","target","value","fontSize","margin","interface_id","length","Component","propTypes","PropTypes","object","array","func","number","bool"],"mappings":"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","file":"InterfaceCaseContent.js","sourceRoot":"C:/Users/DUOYI/Desktop/api/test/vendors","sourcesContent":["import React, { PureComponent as Component } from 'react';\nimport { connect } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router';\nimport { Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { message, Tooltip, Input } from 'antd';\nimport { getEnv } from '../../../../reducer/modules/project';\nimport {\n  fetchInterfaceColList,\n  setColData,\n  fetchCaseData,\n  fetchCaseList\n} from '../../../../reducer/modules/interfaceCol';\nimport { Postman } from '../../../../components';\n\nimport './InterfaceCaseContent.scss';\n\n@connect(\n  state => {\n    return {\n      interfaceColList: state.interfaceCol.interfaceColList,\n      currColId: state.interfaceCol.currColId,\n      currCaseId: state.interfaceCol.currCaseId,\n      currCase: state.interfaceCol.currCase,\n      isShowCol: state.interfaceCol.isShowCol,\n      currProject: state.project.currProject,\n      projectEnv: state.project.projectEnv,\n      curUid: state.user.uid\n    };\n  },\n  {\n    fetchInterfaceColList,\n    fetchCaseData,\n    setColData,\n    fetchCaseList,\n    getEnv\n  }\n)\n@withRouter\nexport default class InterfaceCaseContent extends Component {\n  static propTypes = {\n    match: PropTypes.object,\n    interfaceColList: PropTypes.array,\n    fetchInterfaceColList: PropTypes.func,\n    fetchCaseData: PropTypes.func,\n    setColData: PropTypes.func,\n    fetchCaseList: PropTypes.func,\n    history: PropTypes.object,\n    currColId: PropTypes.number,\n    currCaseId: PropTypes.number,\n    currCase: PropTypes.object,\n    isShowCol: PropTypes.bool,\n    currProject: PropTypes.object,\n    getEnv: PropTypes.func,\n    projectEnv: PropTypes.object,\n    curUid: PropTypes.number\n  };\n\n  state = {\n    isEditingCasename: true,\n    editCasename: ''\n  };\n\n  constructor(props) {\n    super(props);\n  }\n\n  getColId(colList, currCaseId) {\n    let currColId = 0;\n    colList.forEach(col => {\n      col.caseList.forEach(caseItem => {\n        if (+caseItem._id === +currCaseId) {\n          currColId = col._id;\n        }\n      });\n    });\n    return currColId;\n  }\n\n  async componentWillMount() {\n    const result = await this.props.fetchInterfaceColList(this.props.match.params.id);\n    let { currCaseId } = this.props;\n    const params = this.props.match.params;\n    const { actionId } = params;\n    currCaseId = +actionId || +currCaseId || result.payload.data.data[0].caseList[0]._id;\n    let currColId = this.getColId(result.payload.data.data, currCaseId);\n    this.props.history.push('/project/' + params.id + '/interface/case/' + currCaseId);\n    await this.props.fetchCaseData(currCaseId);\n    this.props.setColData({ currCaseId: +currCaseId, currColId, isShowCol: false });\n    // 获取当前case 下的环境变量\n    await this.props.getEnv(this.props.currCase.project_id);\n    // await this.getCurrEnv()\n\n    this.setState({ editCasename: this.props.currCase.casename });\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    const oldCaseId = this.props.match.params.actionId;\n    const newCaseId = nextProps.match.params.actionId;\n    const { interfaceColList } = nextProps;\n    let currColId = this.getColId(interfaceColList, newCaseId);\n    if (oldCaseId !== newCaseId) {\n      await this.props.fetchCaseData(newCaseId);\n      this.props.setColData({ currCaseId: +newCaseId, currColId, isShowCol: false });\n      await this.props.getEnv(this.props.currCase.project_id);\n      // await this.getCurrEnv()\n      this.setState({ editCasename: this.props.currCase.casename });\n    }\n  }\n\n  savePostmanRef = postman => {\n    this.postman = postman;\n  };\n\n  updateCase = async () => {\n    const {\n      case_env,\n      req_params,\n      req_query,\n      req_headers,\n      req_body_type,\n      req_body_form,\n      req_body_other,\n      test_script,\n      enable_script,\n      test_res_body,\n      test_res_header\n    } = this.postman.state;\n\n    const { editCasename: casename } = this.state;\n    const { _id: id } = this.props.currCase;\n    let params = {\n      id,\n      casename,\n      case_env,\n      req_params,\n      req_query,\n      req_headers,\n      req_body_type,\n      req_body_form,\n      req_body_other,\n      test_script,\n      enable_script,\n      test_res_body,\n      test_res_header\n    };\n\n    const res = await axios.post('/api/col/up_case', params);\n    if (this.props.currCase.casename !== casename) {\n      this.props.fetchInterfaceColList(this.props.match.params.id);\n    }\n    if (res.data.errcode) {\n      message.error(res.data.errmsg);\n    } else {\n      message.success('更新成功');\n      this.props.fetchCaseData(id);\n    }\n  };\n\n  triggerEditCasename = () => {\n    this.setState({\n      isEditingCasename: true,\n      editCasename: this.props.currCase.casename\n    });\n  };\n  cancelEditCasename = () => {\n    this.setState({\n      isEditingCasename: false,\n      editCasename: this.props.currCase.casename\n    });\n  };\n\n  render() {\n    const { currCase, currProject, projectEnv } = this.props;\n    const { isEditingCasename, editCasename } = this.state;\n\n    const data = Object.assign(\n      {},\n      currCase,\n      {\n        env: projectEnv.env,\n        pre_script: currProject.pre_script,\n        after_script: currProject.after_script\n      },\n      { _id: currCase._id }\n    );\n\n    return (\n      <div style={{ padding: '6px 0' }} className=\"case-content\">\n        <div className=\"case-title\">\n          {!isEditingCasename && (\n            <Tooltip title=\"点击编辑\" placement=\"bottom\">\n              <div className=\"case-name\" onClick={this.triggerEditCasename}>\n                {currCase.casename}\n              </div>\n            </Tooltip>\n          )}\n\n          {isEditingCasename && (\n            <div className=\"edit-case-name\">\n              <Input\n                value={editCasename}\n                onChange={e => this.setState({ editCasename: e.target.value })}\n                style={{ fontSize: 18 }}\n              />\n            </div>\n          )}\n          <span className=\"inter-link\" style={{ margin: '0px 8px 0px 6px', fontSize: 12 }}>\n            <Link\n              className=\"text\"\n              to={`/project/${currCase.project_id}/interface/api/${currCase.interface_id}`}\n            >\n              对应接口\n            </Link>\n          </span>\n        </div>\n        <div>\n          {Object.keys(currCase).length > 0 && (\n            <Postman\n              data={data}\n              type=\"case\"\n              saveTip=\"更新保存修改\"\n              save={this.updateCase}\n              ref={this.savePostmanRef}\n              interfaceId={currCase.interface_id}\n              projectId={currCase.project_id}\n              curUid={this.props.curUid}\n            />\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n"]}