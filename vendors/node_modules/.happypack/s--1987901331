'use strict';

exports.__esModule = true;
exports.default = undefined;

var _button = require('antd/lib/button');

var _button2 = _interopRequireDefault(_button);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _message2 = require('antd/lib/message');

var _message3 = _interopRequireDefault(_message2);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _form = require('antd/lib/form');

var _form2 = _interopRequireDefault(_form);

var _dec, _dec2, _class, _class2, _temp2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _reactRedux = require('react-redux');

require('./project-request.scss');

var _AceEditor = require('../../../../components/AceEditor/AceEditor');

var _AceEditor2 = _interopRequireDefault(_AceEditor);

var _project = require('../../../../reducer/modules/project');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var FormItem = _form2.default.Item;
var ProjectRequest = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    projectMsg: state.project.currProject
  };
}, {
  updateProjectScript: _project.updateProjectScript,
  getProject: _project.getProject
}), _dec2 = _form2.default.create(), _dec(_class = _dec2(_class = (_temp2 = _class2 = function (_Component) {
  (0, _inherits3.default)(ProjectRequest, _Component);

  function ProjectRequest() {
    var _this2 = this;

    var _temp, _this, _ret;

    (0, _classCallCheck3.default)(this, ProjectRequest);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return _ret = (_temp = (_this = (0, _possibleConstructorReturn3.default)(this, _Component.call.apply(_Component, [this].concat(args))), _this), _this.handleSubmit = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      var result;
      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return _this.props.updateProjectScript({
                id: _this.props.projectId,
                pre_script: _this.state.pre_script,
                after_script: _this.state.after_script
              });

            case 2:
              result = _context.sent;

              if (!(result.payload.data.errcode === 0)) {
                _context.next = 9;
                break;
              }

              _message3.default.success('保存成功');
              _context.next = 7;
              return _this.props.getProject(_this.props.projectId);

            case 7:
              _context.next = 10;
              break;

            case 9:
              _message3.default.success('保存失败, ' + result.payload.data.errmsg);

            case 10:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, _this2);
    })), _temp), (0, _possibleConstructorReturn3.default)(_this, _ret);
  }

  ProjectRequest.prototype.componentWillMount = function componentWillMount() {
    this.setState({
      pre_script: this.props.projectMsg.pre_script,
      after_script: this.props.projectMsg.after_script
    });
  };

  ProjectRequest.prototype.render = function render() {
    var _this3 = this;

    var formItemLayout = {
      labelCol: {
        xs: { span: 24 },
        sm: { span: 6 }
      },
      wrapperCol: {
        xs: { span: 24 },
        sm: { span: 16 }
      }
    };

    var tailFormItemLayout = {
      wrapperCol: {
        xs: {
          span: 24,
          offset: 0
        },
        sm: {
          span: 16,
          offset: 8
        }
      }
    };

    var _state = this.state,
        pre_script = _state.pre_script,
        after_script = _state.after_script;


    return _react2.default.createElement(
      'div',
      { className: 'project-request' },
      _react2.default.createElement(
        _form2.default,
        { onSubmit: this.handleSubmit },
        _react2.default.createElement(
          FormItem,
          (0, _extends3.default)({}, formItemLayout, { label: 'Pre-request Script(\u8BF7\u6C42\u53C2\u6570\u5904\u7406\u811A\u672C)' }),
          _react2.default.createElement(_AceEditor2.default, {
            data: pre_script,
            onChange: function onChange(editor) {
              return _this3.setState({ pre_script: editor.text });
            },
            fullScreen: true,
            className: 'request-editor'
          })
        ),
        _react2.default.createElement(
          FormItem,
          (0, _extends3.default)({}, formItemLayout, { label: 'Pre-response Script(\u54CD\u5E94\u6570\u636E\u5904\u7406\u811A\u672C)' }),
          _react2.default.createElement(_AceEditor2.default, {
            data: after_script,
            onChange: function onChange(editor) {
              return _this3.setState({ after_script: editor.text });
            },
            fullScreen: true,
            className: 'request-editor'
          })
        ),
        _react2.default.createElement(
          FormItem,
          tailFormItemLayout,
          _react2.default.createElement(
            _button2.default,
            { onClick: this.handleSubmit, type: 'primary' },
            '\u4FDD\u5B58'
          )
        )
      )
    );
  };

  return ProjectRequest;
}(_react.PureComponent), _class2.propTypes = {
  projectMsg: _propTypes2.default.object,
  updateProjectScript: _propTypes2.default.func,
  getProject: _propTypes2.default.func,
  projectId: _propTypes2.default.number
}, _temp2)) || _class) || _class);
exports.default = ProjectRequest;