'use strict';

exports.__esModule = true;

var _tooltip = require('antd/lib/tooltip');

var _tooltip2 = _interopRequireDefault(_tooltip);

var _icon = require('antd/lib/icon');

var _icon2 = _interopRequireDefault(_icon);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _message2 = require('antd/lib/message');

var _message3 = _interopRequireDefault(_message2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _modal = require('antd/lib/modal');

var _modal2 = _interopRequireDefault(_modal);

var _dec, _class, _class2, _temp2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

require('./ProjectToken.scss');

var _project = require('../../../../reducer/modules/project');

var _reactRedux = require('react-redux');

var _copyToClipboard = require('copy-to-clipboard');

var _copyToClipboard2 = _interopRequireDefault(_copyToClipboard);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var confirm = _modal2.default.confirm;

var ProjectToken = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    token: state.project.token
  };
}, {
  getToken: _project.getToken,
  updateToken: _project.updateToken
}), _dec(_class = (_temp2 = _class2 = function (_Component) {
  (0, _inherits3.default)(ProjectToken, _Component);

  function ProjectToken() {
    var _temp, _this, _ret;

    (0, _classCallCheck3.default)(this, ProjectToken);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return _ret = (_temp = (_this = (0, _possibleConstructorReturn3.default)(this, _Component.call.apply(_Component, [this].concat(args))), _this), _this.copyToken = function () {
      (0, _copyToClipboard2.default)(_this.props.token);
      _message3.default.success('已经成功复制到剪切板');
    }, _this.updateToken = function () {
      var that = _this;
      confirm({
        title: '重新生成key',
        content: '重新生成之后，之前的key将无法使用，确认重新生成吗？',
        okText: '确认',
        cancelText: '取消',
        onOk: function onOk() {
          var _this2 = this;

          return (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
            return _regenerator2.default.wrap(function _callee$(_context) {
              while (1) {
                switch (_context.prev = _context.next) {
                  case 0:
                    _context.next = 2;
                    return that.props.updateToken(that.props.projectId);

                  case 2:
                    _message3.default.success('更新成功');

                  case 3:
                  case 'end':
                    return _context.stop();
                }
              }
            }, _callee, _this2);
          }))();
        },
        onCancel: function onCancel() {}
      });
    }, _temp), (0, _possibleConstructorReturn3.default)(_this, _ret);
  }

  ProjectToken.prototype.componentDidMount = function () {
    var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {
      return _regenerator2.default.wrap(function _callee2$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return this.props.getToken(this.props.projectId);

            case 2:
            case 'end':
              return _context2.stop();
          }
        }
      }, _callee2, this);
    }));

    function componentDidMount() {
      return _ref.apply(this, arguments);
    }

    return componentDidMount;
  }();

  ProjectToken.prototype.render = function render() {
    return _react2.default.createElement(
      'div',
      { className: 'project-token' },
      _react2.default.createElement(
        'h2',
        { className: 'token-title' },
        '\u5DE5\u5177\u6807\u8BC6'
      ),
      _react2.default.createElement(
        'div',
        { className: 'message' },
        '\u6BCF\u4E2A\u9879\u76EE\u90FD\u6709\u552F\u4E00\u7684\u6807\u8BC6token\uFF0C\u7528\u6237\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2Atoken\u503C\u6765\u8BF7\u6C42\u9879\u76EE openapi.'
      ),
      _react2.default.createElement(
        'div',
        { className: 'token' },
        _react2.default.createElement(
          'span',
          null,
          'token: ',
          _react2.default.createElement(
            'span',
            { className: 'token-message' },
            this.props.token
          )
        ),
        _react2.default.createElement(
          _tooltip2.default,
          { title: '\u590D\u5236' },
          _react2.default.createElement(_icon2.default, { className: 'token-btn', type: 'copy', onClick: this.copyToken })
        ),
        this.props.curProjectRole === 'admin' || this.props.curProjectRole === 'owner' ? _react2.default.createElement(
          _tooltip2.default,
          { title: '\u5237\u65B0' },
          _react2.default.createElement(_icon2.default, { className: 'token-btn', type: 'reload', onClick: this.updateToken })
        ) : null
      ),
      _react2.default.createElement(
        'div',
        { className: 'blockquote' },
        '\u4E3A\u786E\u4FDD\u9879\u76EE\u5185\u6570\u636E\u7684\u5B89\u5168\u6027\u548C\u79C1\u5BC6\u6027\uFF0C\u8BF7\u52FF\u8F7B\u6613\u5C06\u8BE5token\u66B4\u9732\u7ED9\u9879\u76EE\u7EC4\u5916\u7528\u6237\u3002'
      ),
      _react2.default.createElement('br', null),
      _react2.default.createElement(
        'h2',
        { className: 'token-title' },
        'open\u63A5\u53E3\uFF1A'
      ),
      _react2.default.createElement(
        'p',
        null,
        _react2.default.createElement(
          'a',
          { target: '_blank', rel: 'noopener noreferrer', href: 'https://hellosean1025.github.io/yapi/openapi.html' },
          '\u8BE6\u7EC6\u63A5\u53E3\u6587\u6863'
        )
      ),
      _react2.default.createElement(
        'div',
        null,
        _react2.default.createElement(
          'ul',
          { className: 'open-api' },
          _react2.default.createElement(
            'li',
            null,
            '/api/open/run_auto_test [\u8FD0\u884C\u81EA\u52A8\u5316\u6D4B\u8BD5]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/open/import_data [\u5BFC\u5165\u6570\u636E]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/add [\u65B0\u589E\u63A5\u53E3]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/save [\u4FDD\u5B58\u63A5\u53E3]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/up [\u66F4\u65B0\u63A5\u53E3]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/get [\u83B7\u53D6\u63A5\u53E3]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/list [\u83B7\u53D6\u63A5\u53E3\u5217\u8868]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/list_menu [\u83B7\u53D6\u63A5\u53E3\u83DC\u5355]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/add_cat [\u65B0\u589E\u63A5\u53E3\u5206\u7C7B]'
          ),
          _react2.default.createElement(
            'li',
            null,
            '/api/interface/getCatMenu [\u83B7\u53D6\u6240\u6709\u5206\u7C7B]'
          )
        )
      )
    );
  };

  return ProjectToken;
}(_react.Component), _class2.propTypes = {
  projectId: _propTypes2.default.number,
  getToken: _propTypes2.default.func,
  token: _propTypes2.default.string,
  updateToken: _propTypes2.default.func,
  curProjectRole: _propTypes2.default.string
}, _temp2)) || _class);
exports.default = ProjectToken;