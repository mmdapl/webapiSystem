'use strict';

exports.__esModule = true;
exports.default = undefined;

var _alert = require('antd/lib/alert');

var _alert2 = _interopRequireDefault(_alert);

var _message2 = require('antd/lib/message');

var _message3 = _interopRequireDefault(_message2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Notify = function (_Component) {
  (0, _inherits3.default)(Notify, _Component);

  function Notify(props) {
    (0, _classCallCheck3.default)(this, Notify);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.state = {
      newVersion: process.env.version,
      version: process.env.version
    };
    return _this;
  }

  Notify.prototype.componentDidMount = function componentDidMount() {
    var _this2 = this;

    _axios2.default.get('https://www.easy-mock.com/mock/5c2851e3d84c733cb500c3b9/yapi/versions').then(function (req) {
      if (req.status === 200) {
        _this2.setState({ newVersion: req.data.data[0] });
      } else {
        _message3.default.error('无法获取新版本信息！');
      }
    });
  };

  Notify.prototype.render = function render() {
    var isShow = this.state.newVersion !== this.state.version;
    return _react2.default.createElement(
      'div',
      null,
      isShow && _react2.default.createElement(_alert2.default, {
        message: _react2.default.createElement(
          'div',
          null,
          '\u5F53\u524D\u7248\u672C\u662F\uFF1A',
          this.state.version,
          '\xA0\xA0\u53EF\u5347\u7EA7\u5230: ',
          this.state.newVersion,
          '\xA0\xA0\xA0',
          _react2.default.createElement(
            'a',
            {
              target: 'view_window',
              href: 'https://github.com/YMFE/yapi/blob/master/CHANGELOG.md'
            },
            '\u7248\u672C\u8BE6\u60C5'
          )
        ),
        banner: true,
        closable: true,
        type: 'info'
      })
    );
  };

  return Notify;
}(_react.Component);

exports.default = Notify;