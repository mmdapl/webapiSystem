'use strict';

exports.__esModule = true;

var _row = require('antd/lib/row');

var _row2 = _interopRequireDefault(_row);

var _col = require('antd/lib/col');

var _col2 = _interopRequireDefault(_col);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _dec, _class, _class2, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

require('./Follows.scss');

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _reactRedux = require('react-redux');

var _follow = require('../../reducer/modules/follow');

var _user = require('../../reducer/modules/user');

var _ProjectCard = require('../../components/ProjectCard/ProjectCard.js');

var _ProjectCard2 = _interopRequireDefault(_ProjectCard);

var _ErrMsg = require('../../components/ErrMsg/ErrMsg.js');

var _ErrMsg2 = _interopRequireDefault(_ErrMsg);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Follows = (_dec = (0, _reactRedux.connect)(function (state) {
  return {
    data: state.follow.data,
    uid: state.user.uid
  };
}, {
  getFollowList: _follow.getFollowList,
  setBreadcrumb: _user.setBreadcrumb
}), _dec(_class = (_temp = _class2 = function (_Component) {
  (0, _inherits3.default)(Follows, _Component);

  function Follows(props) {
    (0, _classCallCheck3.default)(this, Follows);

    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));

    _this.receiveRes = function () {
      _this.props.getFollowList(_this.props.uid).then(function (res) {
        if (res.payload.data.errcode === 0) {
          _this.setState({
            data: res.payload.data.data.list
          });
        }
      });
    };

    _this.state = {
      data: []
    };
    return _this;
  }

  Follows.prototype.componentWillMount = function () {
    var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
      var _this2 = this;

      return _regenerator2.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              this.props.setBreadcrumb([{ name: '我的关注' }]);
              this.props.getFollowList(this.props.uid).then(function (res) {
                if (res.payload.data.errcode === 0) {
                  _this2.setState({
                    data: res.payload.data.data.list
                  });
                }
              });

            case 2:
            case 'end':
              return _context.stop();
          }
        }
      }, _callee, this);
    }));

    function componentWillMount() {
      return _ref.apply(this, arguments);
    }

    return componentWillMount;
  }();

  Follows.prototype.render = function render() {
    var _this3 = this;

    var data = this.state.data;
    data = data.sort(function (a, b) {
      return b.up_time - a.up_time;
    });
    return _react2.default.createElement(
      'div',
      null,
      _react2.default.createElement(
        'div',
        { className: 'g-row', style: { paddingLeft: '32px', paddingRight: '32px' } },
        _react2.default.createElement(
          _row2.default,
          { gutter: 16, className: 'follow-box pannel-without-tab' },
          data.length ? data.map(function (item, index) {
            return _react2.default.createElement(
              _col2.default,
              { xs: 6, md: 4, xl: 3, key: index },
              _react2.default.createElement(_ProjectCard2.default, {
                projectData: item,
                inFollowPage: true,
                callbackResult: _this3.receiveRes
              })
            );
          }) : _react2.default.createElement(_ErrMsg2.default, { type: 'noFollow' })
        )
      )
    );
  };

  return Follows;
}(_react.PureComponent), _class2.propTypes = {
  getFollowList: _propTypes2.default.func,
  setBreadcrumb: _propTypes2.default.func,
  uid: _propTypes2.default.number
}, _temp)) || _class);
exports.default = Follows;